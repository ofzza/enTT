{"version":3,"sources":["prototype/index.js"],"names":["EntityPrototype","value","EntityClass","bind","collection","debug","constructor","Error","modules","propertyDefinitions","watchers","Object","defineProperty","configurable","enumerable","get","callback","properties","registerWatcher","fn","manualUpdate"],"mappings":";;;;;;;qjBAAA;AACA;AACA;AACA;;AAEA;;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;AAEA;;;;;IAKqBA,e;;;;;AAUnB;;;;;;;;yBAQaC,K,EAAOC,W,EAAa;AAAE,aAAO,sBAAaC,IAAb,CAAkB,IAAlB,EAAwBF,KAAxB,EAA+BC,WAA/B,CAAP;AAAqD;AACxF;;;;;;;;;;;mCAQuBE,U,EAAYF,W,EAAa;AAAE,aAAO,gCAAuBC,IAAvB,CAA4B,IAA5B,EAAkCC,UAAlC,EAA8CF,WAA9C,CAAP;AAAoE;AACtH;;;;;;;;;AA1BA;;;;;wBAKoB;AAAE,aAAO,gBAAMG,KAAb;AAAqB,K;sBACzBJ,K,EAAO;AAAE,sBAAMI,KAAN,GAAcJ,KAAd;AAAsB;;;AAwBjD,6BAAe;AAAA;;AAEb;AACA,QAAI,KAAKK,WAAL,KAAqBN,eAAzB,EAA0C;AACxC,YAAM,IAAIO,KAAJ,CAAU,iGAAV,CAAN;AACD;;AAED;;AAPa,gCAQ0B,yBAA2BJ,IAA3B,CAAgC,IAAhC,GAR1B;AAAA,QAQPK,OARO,yBAQPA,OARO;AAAA,QAQEC,mBARF,yBAQEA,mBARF;;AAUb;;;AACA,QAAMC,WAAW,uBAAa,IAAb,CAAjB;AACA;AACAC,WAAOC,cAAP,CAAsB,IAAtB,EAA4B,OAA5B,EAAqC;AACnCC,oBAAc,KADqB;AAEnCC,kBAAY,KAFuB;AAGnCC,WAAK,eAAM;;AAET;;;;;;;;;AASA,eAAO,UAACC,QAAD,EAAiC;AAAA,cAAtBC,UAAsB,uEAAT,IAAS;AAAE,iBAAOP,SAASQ,eAAT,CAAyBF,QAAzB,EAAmCC,UAAnC,CAAP;AAAwD,SAAlG;AAED;AAhBkC,KAArC;AAkBA;AACAN,WAAOC,cAAP,CAAsB,IAAtB,EAA4B,QAA5B,EAAsC;AACpCC,oBAAc,KADsB;AAEpCC,kBAAY,KAFwB;AAGpCC,WAAK,eAAM;;AAET;;;;;;;AAOA,eAAO,UAACI,EAAD,EAAQ;AAAET,mBAASU,YAAT,CAAsBD,EAAtB;AAA4B,SAA7C;AAED;AAdmC,KAAtC;;AAiBA;AACA,yBAA4BhB,IAA5B,CAAiC,IAAjC,EAAuCK,OAAvC,EAAgDC,mBAAhD,EAAqEC,QAArE;AAED;;;;;kBApFkBV,e","file":"prototype/index.js","sourcesContent":["// =====================================================================================================================\n// ENTITY: Basic class prototype\n// TODO: Allow subscribing to changes (via setters or manual updated notification)\n// =====================================================================================================================\n\n// Import dependencies\nimport { castAsEntity, castCollectionAsEntity } from './casting';\nimport fetchAllFromPrototypeChain from './initialization';\nimport initializeManagedProperties from './properties';\nimport Debug from './debug';\nimport Watchers from './watchers';\n\n/**\n * Entity prototype class\n * @export\n * @class EntityPrototype\n */\nexport default class EntityPrototype {\n\n  /**\n   * Debugging status (When debugging, some extra properties are exposed)\n   * @static\n   * @memberof EntityPrototype\n   */\n  static get debug () { return Debug.debug; }\n  static set debug (value) { Debug.debug = value; }\n\n  /**\n   * Casts value as entity by copying content of all properties found on both\n   * @static\n   * @param {any} value Value to cast\n   * @param {any} EntityClass Target casting Entity class\n   * @returns {any} Cast instance of required Entity class\n   * @memberof Watchers\n   */\n  static cast (value, EntityClass) { return castAsEntity.bind(this)(value, EntityClass); }\n  /**\n   * Casts collection of values as a collection of entities by casting each mamber of the collection\n   * @static\n   * @param {any} collection Collection to cast\n   * @param {any} EntityClass Target casting Entity class\n   * @returns {any} Cast collection\n   * @memberof Entity\n   */\n  static castCollection (collection, EntityClass) { return castCollectionAsEntity.bind(this)(collection, EntityClass); }\n  /**\n   * Creates an instance of EntityPrototype.\n   * @memberof EntityPrototype\n   */\n  constructor () {\n\n    // Check if class neing directly instantiated\n    if (this.constructor === EntityPrototype) {\n      throw new Error('EntityPrototype class is not meant to be instantiated directly - extend it with your own class!');\n    }\n\n    // Check if prototype contains static definition property - if so validate and process it\n    let { modules, propertyDefinitions } = fetchAllFromPrototypeChain.bind(this)();\n\n    // Initialize watchers repository\n    const watchers = new Watchers(this);\n    // Expose watch method\n    Object.defineProperty(this, 'watch', {\n      configurable: false,\n      enumerable: false,\n      get: () => {\n\n        /**\n         * Sets a callback that triggers when watched property changes\n         * @param {any} callback Callback fruntion triggered on detected changes:\n         *              (e = { entity, property }) => { ... code acting on change ...}\n         * @param {any} properties Name of the property (or array  of names) that is being watched;\n         *              If no property name specified, all changes on the entity instance will trigger callback\n         * @returns {function} Function which when called, cancels the set watcher\n         * @memberof EntityPrototype\n         */\n        return (callback, properties = null) => { return watchers.registerWatcher(callback, properties); };\n\n      }\n    });\n    // Expose update method\n    Object.defineProperty(this, 'update', {\n      configurable: false,\n      enumerable: false,\n      get: () => {\n\n        /**\n         * Executes the provided function (meant to be manually applying changes to the entity instance)\n         * and when done triggers watchers.\n         * If function returns a property name or an array of property names, watchers will only trigger for those proeprties.\n         * @param {any} fn Function meant to be manually applying changes to the entity instance\n         * @memberof Watchers\n         */\n        return (fn) => { watchers.manualUpdate(fn); };\n\n      }\n    });\n\n    // Initialize managed properties based on definitions\n    initializeManagedProperties.bind(this)(modules, propertyDefinitions, watchers);\n\n  }\n\n}\n"],"sourceRoot":"/source/"}